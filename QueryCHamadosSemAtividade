"PesquisaPorData
UsuarioSolicitanteID
PessoaID
DescriçãoCHamado
ChamadoSetorIDChamadosSematividades
FIliaisTmsChamadoSemAtividade
EmpresaID"


SELECT {CHAMADO}.[ID] , {CHAMADO_SETOR}.[DESCRICAO_SETOR], {CHAMADO}.[DATA_SOLICITACAO], {USUARIOS_INTERNOS}.[EMAIL], {CHAMADO_CLASSIFICACAO}.[DESCRICAO], {CHAMADO}.[DESCRICAO_SOLICITACAO], A.[EMAIL], {CHAMADO}.[DATA_INCLUSAO], B.[EMAIL], {CHAMADO}.[DATA_ALTERACAO], {PESSOA}.[NOME], {EMPRESA}.[RAZAO_SOCIAL], {CHAMADO}.[HANDLE_FILIAL_RESP]

FROM {CHAMADO}

JOIN {CHAMADO_SETOR} WITH (NOLOCK) ON {CHAMADO}.[ID_CHAMADO_SETOR] = {CHAMADO_SETOR}.[ID]
JOIN {USUARIOS_INTERNOS} WITH (NOLOCK) ON {CHAMADO}.[HANDLE_USUARIOINTERNOS_SOLICITANTE] = {USUARIOS_INTERNOS}.[HANDLE]
JOIN {CHAMADO_CLASSIFICACAO} WITH (NOLOCK) ON {CHAMADO}.[ID_CHAMADO_CLASSIFICACAO] = {CHAMADO_CLASSIFICACAO}.[ID]
JOIN {USUARIOS_INTERNOS} AS A ON {CHAMADO}.[HANDLE_USUARIOINTERNOS_INCLUSAO] = A.[HANDLE]
LEFT JOIN {CHAMADO_ATIVIDADE} WITH (NOLOCK) ON {CHAMADO}.[ID] = {CHAMADO_ATIVIDADE}.[ID_CHAMADO]
LEFT JOIN {USUARIOS_INTERNOS} AS B ON {CHAMADO}.[HANDLE_USUARIOINTERNOS_ALTERACAO] = B.[HANDLE]
LEFT JOIN {PESSOA} WITH (NOLOCK) ON {CHAMADO}.[ID_PESSOA] = {PESSOA}.[ID]
LEFT JOIN {EMPRESA} WITH (NOLOCK) ON {CHAMADO_SETOR}.[ID_EMPRESA] = {EMPRESA}.[ID]

WHERE
 
@PesquisaPorData AND 
( ({CHAMADO}.[HANDLE_USUARIOINTERNOS_SOLICITANTE] = @UsuarioSolicitanteID) OR (@UsuarioSolicitanteID IS NULL) OR (@UsuarioSolicitanteID = '' )) AND
( ({CHAMADO}.[ID_PESSOA] = @PessoaID) OR (@PessoaID IS NULL) OR (@PessoaID = '') ) AND
(({CHAMADO}.[ID_CHAMADO_SETOR]=@ChamadoSetorIDChamadosSematividades) OR (@ChamadoSetorIDChamadosSematividades IS NULL) OR (@ChamadoSetorIDChamadosSematividades='')) AND
(({CHAMADO}.[HANDLE_FILIAL_RESP]=@FIliaisTmsChamadoSemAtividade) OR (@FIliaisTmsChamadoSemAtividade IS NULL) OR (@FIliaisTmsChamadoSemAtividade='')) AND
{CHAMADO}.[DESCRICAO_SOLICITACAO] LIKE '%' + @DescricaoChamado + '%' AND
(({CHAMADO_SETOR}.[ID_EMPRESA] = @EmpresaID) OR (@EmpresaID IS NULL) OR (@EmpresaID= '')) AND

{CHAMADO_ATIVIDADE}.[ID_CHAMADO]  Is Null

ORDER BY {CHAMADO}.[ID] DESC









