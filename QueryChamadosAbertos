ChamadoID
PesquiaPorData
UsuarioSolicitanteId
PessoaID
DescricaoChamado
ChamadoSetorIDChamadosAbertos
FIliaisTmsID
EmpresaID


SELECT {CHAMADO}.[ID], {CHAMADO_SETOR}.[DESCRICAO_SETOR], {CHAMADO}.[DATA_SOLICITACAO], {USUARIOS_INTERNOS}.[EMAIL], {CHAMADO_CLASSIFICACAO}.[DESCRICAO], {CHAMADO}.[DESCRICAO_SOLICITACAO], A.[NOME], {CHAMADO}.[DATA_INCLUSAO], B.[NOME], {CHAMADO}.[DATA_ALTERACAO], {PESSOA}.[NOME], {EMPRESA}.[RAZAO_SOCIAL] ,{FILIAIS_TMS}.[NOME]

FROM {CHAMADO}

JOIN {CHAMADO_SETOR} WITH (NOLOCK) ON {CHAMADO}.[ID_CHAMADO_SETOR] = {CHAMADO_SETOR}.[ID]
JOIN {USUARIOS_INTERNOS} WITH (NOLOCK) ON {CHAMADO}.[HANDLE_USUARIOINTERNOS_SOLICITANTE] = {USUARIOS_INTERNOS}.[HANDLE]
JOIN {CHAMADO_CLASSIFICACAO} WITH (NOLOCK) ON {CHAMADO}.[ID_CHAMADO_CLASSIFICACAO] = {CHAMADO_CLASSIFICACAO}.[ID]
JOIN {USUARIOS_INTERNOS}  AS A ON {CHAMADO}.[HANDLE_USUARIOINTERNOS_INCLUSAO] = A.[HANDLE]

LEFT JOIN {FILIAIS_TMS} WITH (NOLOCK) ON {CHAMADO}.[HANDLE_FILIAL_RESP] = {FILIAIS_TMS}.[HANDLE]
LEFT JOIN {USUARIOS_INTERNOS} AS B ON {CHAMADO}.[HANDLE_USUARIOINTERNOS_ALTERACAO] = B.[HANDLE]
LEFT JOIN {PESSOA} WITH (NOLOCK) ON {CHAMADO}.[ID_PESSOA] = {PESSOA}.[ID]
LEFT JOIN {EMPRESA} WITH (NOLOCK) ON {CHAMADO_SETOR}.[ID_EMPRESA] = {EMPRESA}.[ID]

WHERE 

@PesquiaPorData AND 
(({CHAMADO}.[HANDLE_USUARIOINTERNOS_SOLICITANTE] = @UsuarioSolicitanteId) OR (@UsuarioSolicitanteId IS NULL) OR (@UsuarioSolicitanteId = '' )) AND
(({CHAMADO}.[ID_PESSOA] = @PessoaId) OR (@PessoaId IS NULL) OR (@PessoaId = '') ) AND
{CHAMADO}.[DESCRICAO_SOLICITACAO] LIKE '%' + @DescricaoChamado + '%'  AND
(({CHAMADO}.[ID_CHAMADO_SETOR] = @ChamadoSetorIDChamadosAbertos) OR (@ChamadoSetorIDChamadosAbertos IS NULL) OR (@ChamadoSetorIDChamadosAbertos='')) AND
(({CHAMADO}.[HANDLE_FILIAL_RESP] = @FIliaisTmsID) OR (@FIliaisTmsID IS NULL) OR (@FIliaisTmsID = '')) AND
({CHAMADO}.[DATA_ENCERRAMENTO] IS NULL OR {CHAMADO}.[DATA_ENCERRAMENTO] = '1900/01/01') AND
(({CHAMADO_SETOR}.[ID_EMPRESA] = @EmpresaID) OR (@EmpresaID IS NULL) OR (@EmpresaID= '')) AND
{CHAMADO}.[ID] LIKE '%' + @chamadoID + '%'


ORDER BY {CHAMADO}.[ID] DESC
